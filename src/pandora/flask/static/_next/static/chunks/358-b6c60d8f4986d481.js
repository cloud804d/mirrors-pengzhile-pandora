"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[358],{68619:function(e,t,n){var r,o,i,s,a,u,d,l,c,g;n.d(t,{Jq:function(){return a},Os:function(){return i},uU:function(){return s}}),(u=r||(r={})).Default="default",u.Dark="dark",(d=o||(o={})).Retrieval="retrieval",(l=i||(i={})).Next="next",l.Variant="variant",l.Continue="continue",(c=s||(s={})).Unknown="unknown",c.User="user",c.Assistant="assistant",c.System="system",c.Critic="critic",c.Tool="tool",(g=a||(a={})).Root="root",g.System="system",g.Prompt="prompt",g.Completion="completion"},80836:function(e,t,n){n.d(t,{Cv:function(){return N},uV:function(){return F}});var r,o,i=n(35025),s=n(33468),a=n(37495),u=n(75106),d=n(43905),l=n(33861),c=n(31501),g=n(89874),f=n(64705),h=n(25769),m=n(84251),p=n.n(m),v=n(8844),Z=n(36613),y=n(68619),M=(r={},(0,l.Z)(r,y.Jq.Root,y.uU.Unknown),(0,l.Z)(r,y.Jq.Prompt,y.uU.User),(0,l.Z)(r,y.Jq.Completion,y.uU.Assistant),(0,l.Z)(r,y.Jq.System,y.uU.System),r),F=(o={},(0,l.Z)(o,y.uU.Unknown,y.Jq.Root),(0,l.Z)(o,y.uU.System,y.Jq.System),(0,l.Z)(o,y.uU.User,y.Jq.Prompt),(0,l.Z)(o,y.uU.Assistant,y.Jq.Completion),(0,l.Z)(o,y.uU.Critic,y.Jq.Completion),(0,l.Z)(o,y.uU.Tool,y.Jq.Completion),o),I=new WeakMap,T=new WeakMap,N=function(){function e(t){(0,i.Z)(this,e),(0,a.Z)(this,I,{writable:!0,value:void 0}),(0,a.Z)(this,T,{writable:!0,value:void 0}),(0,u.Z)(this,I,t||e.createTree());var n=Object.values((0,s.Z)(this,I)).find(function(e){return e.type===y.Jq.Root});(0,u.Z)(this,T,(null==n?void 0:n.id)||"root")}var t=e.prototype;return t.getNode=function(e){return(0,s.Z)(this,I)[e]},t.getMessage=function(e){return(0,s.Z)(this,I)[e].message},t.getMessageId=function(e){return(0,s.Z)(this,I)[e].message.id},t.getMetadata=function(e){return(0,s.Z)(this,I)[e].metadata},t.getLeafFromNode=function(e){for(var t=(0,s.Z)(this,I)[e];;){if(0===t.children.length)return t;t=(0,s.Z)(this,I)[t.children.values().next().value]}},t.getParent=function(e){var t=(0,s.Z)(this,I)[e].parentId;return(0,s.Z)(this,I)[t]},t.getParentId=function(e){var t;return(null===(t=this.getParent(e))||void 0===t?void 0:t.id)||"root"},t.getBranchFromLeaf=function(e){for(var t=[],n=(0,s.Z)(this,I)[e];t.push(n),"root"!==n.type;)n=(0,s.Z)(this,I)[n.parentId];return t.reverse()},t.getChildrenFromNode=function(e){var t=this,n=(0,s.Z)(this,I)[e];return n?Array.from(n.children).map(function(e){return(0,s.Z)(t,I)[e]}):[]},t.getFirstPrompt=function(){for(var e,t=this.getNode((0,s.Z)(this,T));;){if(!t)return;if(t.type===y.Jq.Prompt)return t;t=(0,s.Z)(this,I)[null===(e=t.children)||void 0===e?void 0:e[0]]}},t.isMessageIncomplete=function(t){var n=this.getMessage(t);return e.getIsIncompleteFromMessage(n)},t.addNodeToEnd=function(e,t){if(!(0,s.Z)(this,I)[e])return(0,l.Z)({},t.id,t);(0,u.Z)(this,I,p()((0,s.Z)(this,I),(0,l.Z)({$merge:(0,l.Z)({},t.id,t)},e,{children:{$apply:function(e){return Array.from(new Set((0,f.Z)(e).concat([t.id])))}}})))},t.appendSystemMessageToRoot=function(e){var t,n,r=null===(t=this.getFirstPrompt())||void 0===t?void 0:t.parentId;if(r){var o=this.getNode(r),i=this.getNode(o.children[0]),a={id:e.id,children:o.children,parentId:o.id,message:e};(0,u.Z)(this,I,p()((0,s.Z)(this,I),(n={$merge:(0,l.Z)({},a.id,a)},(0,l.Z)(n,o.id,{children:{$set:[a.id]}}),(0,l.Z)(n,i.id,{parentId:{$set:a.id}}),n)))}},t.addNode=function(e,t,n,r,o){var i="string"==typeof t?{id:(0,v.Z)(),author:{role:M[r]},role:M[r],content:{content_type:"text",parts:[t]}}:t,s=(0,c.Z)({id:e,children:[],parentId:n,type:r,message:i},o?{metadata:o}:{});this.addNodeToEnd(n,s)},t.updateNode=function(e,t){(0,u.Z)(this,I,p()((0,s.Z)(this,I),(0,l.Z)({},e,t)))},t.updateNodeMessage=function(e,t){(0,u.Z)(this,I,p()((0,s.Z)(this,I),(0,l.Z)({},e,{message:{$set:t}})))},t.updateNodeText=function(e,t){(0,u.Z)(this,I,p()((0,s.Z)(this,I),(0,l.Z)({},e,{message:{content:{parts:{$set:[t]}}}})))},t.deleteNode=function(e){var t=(0,s.Z)(this,I),n=t[e],r=(0,g.Z)(t,[e].map(h.Z)),o=n.parentId;(0,u.Z)(this,I,p()(r,(0,l.Z)({},o,{children:{$apply:function(t){return t.filter(function(t){return t!==e})}}})))},t.getTextFromNode=function(t){return e.getTextFromMessage(this.getMessage(t))},t.getIsBlockedFromNode=function(e){var t,n,r=this.getNode(e);return r&&(null===(t=r.metadata)||void 0===t?void 0:t.errCode)===Z.Dd&&(null===(n=r.metadata)||void 0===n?void 0:n.errType)==="danger"},t.getTextFromThread=function(t){return this.getBranchFromLeaf(t).filter(function(e){return e.type!==y.Jq.Root&&e.type!==y.Jq.System}).map(function(t){return e.getTextFromMessage(t.message)}).join("\n\n")},t.getTextFromLastNTurns=function(t,n){var r=arguments.length>2&&void 0!==arguments[2]&&arguments[2],o=function(t){var n=t.message,r=e.getMessageType(n),o=t.message.author.role===y.uU.System,i=t.message.author.role===y.uU.Tool;return o||i&&!("code"===r||"execution_output"===r||"system_error"===r)};return this.getConversationTurns(t,o).slice(-n).map(function(t){var n=t.messages.map(function(t){return e.getTextFromMessage(t.message)}).filter(function(e){return""!==e}).join("\n");return r?"[".concat(t.role,"]\n").concat(n):n}).join("\n")},t.getConversationTurns=function(t,n){var r=this,o=[];return this.getBranchFromLeaf(t).forEach(function(t){var i=t.id,a=t.parentId,u=t.message,d=t.metadata;if(null==n||!n(t)){var l=o[o.length-1];(null==l?void 0:l.role)===e.getRoleFromMessage(u)||e.getRoleFromMessage(u)===y.uU.Tool?o[o.length-1].messages.push((0,c.Z)({nodeId:i,parentId:a,message:u},d)):o.push({role:e.getRoleFromMessage(u),messages:[(0,c.Z)({nodeId:i,parentId:a,message:u},d),],variantIds:a?Array.from((0,s.Z)(r,I)[a].children):[i]})}}),o},t.getParentPromptNode=function(e){for(var t,n,r=this.getNode(e);r&&r&&(null===(t=r.message)||void 0===t?void 0:null===(n=t.author)||void 0===n?void 0:n.role)!==y.uU.User;)r=this.getNode(r.parentId);return r},e.createTree=function(){return{root:{id:"root",children:[],parentId:"",type:y.Jq.Root,message:e.createRootMessage()}}},e.createRootMessage=function(){return{id:(0,v.Z)(),author:{role:M[y.Jq.Root]},role:M[y.Jq.Root],content:{content_type:"text",parts:[]}}},e.getIsIncompleteFromMessage=function(e){var t,n;return(null===(t=e.metadata)||void 0===t?void 0:null===(n=t.finish_details)||void 0===n?void 0:n.type)==="max_tokens"},e.getWasInterruptedFromMessage=function(e){var t,n;return(null===(t=e.metadata)||void 0===t?void 0:null===(n=t.finish_details)||void 0===n?void 0:n.type)==="interrupted"},e.getIsContinuedFromMessage=function(e){var t;return(null===(t=e.metadata)||void 0===t?void 0:t.message_type)==="continue"},e.getModelFromMessage=function(e){var t;return null===(t=e.metadata)||void 0===t?void 0:t.model_slug},e.getTextFromMessage=function(e){if(e.content.content_type.startsWith("tether_b"))return e.content.text;switch(e.content.content_type){case"text":return e.content.parts.join("");case"code":case"execution_output":case"system_error":return e.content.text;default:return""}},e.getMessageType=function(e){return e.content.content_type},e.getIsTextTypeFromMessage=function(t){return"text"===e.getMessageType(t)},e.getRequestIdFromConversationTurn=function(e){var t=e.messages[e.messages.length-1];return this.getIsContinuedFromMessage(t.message)?t.nodeId:e.messages[0].nodeId},e.getRoleFromMessage=function(e){var t;return(null===(t=e.author)||void 0===t?void 0:t.role)||e.role},e.getNameFromMessage=function(e){var t,n;return(null===(t=e.author)||void 0===t?void 0:t.name)||(null===(n=e.author)||void 0===n?void 0:n.role)||e.role},e.getRecipientFromMessage=function(e){return e.recipient||""},(0,d.Z)(e,[{key:"isFirstCompletion",get:function(){var e=this.getFirstPrompt();if(e){var t=(0,s.Z)(this,I)[e.children[0]];if(t&&0===t.children.length)return!0}return!1}}]),e}()},82018:function(e,t,n){n.d(t,{kP:function(){return g},w7:function(){return d}});var r=n(61706),o=n(31501),i=n(45813),s=n(87762),a=n(44928),u=n(61432);function d(e){(0,a.signOut)((0,o.Z)({callbackUrl:window.location.origin+"/api/auth/logout"},e))}function l(){return c.apply(this,arguments)}function c(){return(c=(0,r.Z)(function(){var e,t;return(0,i.__generator)(this,function(e){switch(e.label){case 0:return[4,fetch("/api/auth/session")];case 1:return[4,e.sent().json()];case 2:if(Object.keys(t=e.sent()).length)return[2,t];return[2,null]}})})).apply(this,arguments)}function g(e){var t=e||{},n=t.required,r=t.redirectTo,o=t.queryConfig,i=(0,u.useRouter)(),a=(0,s.a)(["session"],l,{onSettled:function(e,t){(null==o?void 0:o.onSettled)&&(null==o||o.onSettled(e,t)),!e&&n&&i.push(r)}});return{session:(null==a?void 0:a.data)||null,loading:(null==a?void 0:a.status)==="loading"}}},36613:function(e,t,n){n.d(t,{Dd:function(){return s},Mf:function(){return a},_I:function(){return d},sK:function(){return u}});var r=n(95182),o=n.n(r),i=n(60814),s="content_policy",a={errType:"warning",errCode:s},u={err:"Contents may violate our content policy",errType:"danger",errCode:s};function d(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=arguments.length>2?arguments[2]:void 0,r=arguments.length>3?arguments[3]:void 0,s=o()(e.length,0,4e3),a=o()(e.length-s,0,e.length-1),u=t?e.substring(a,e.length):e;return 0?i.ZP.runModerationApi(u,n,r).then(function(e){var t,n;return{isBlocked:Boolean(e.blocked),isFlagged:Boolean(e.flagged)}}).catch(function(e){return console.error(e),{isBlocked:!1,isFlagged:!1,error:e}}):Promise.resolve({isBlocked:!1,isFlagged:!1})}}}]);